# WebSocket 1006 é”™è¯¯è§£å†³æŒ‡å—

## ğŸš¨ é—®é¢˜æè¿°

**é”™è¯¯ä»£ç **: 1006  
**é”™è¯¯ä¿¡æ¯**: "è¿æ¥å¤±è´¥: 1006"  
**å«ä¹‰**: WebSocketè¿æ¥å¼‚å¸¸å…³é—­

## ğŸ” é—®é¢˜åˆ†æ

### é”™è¯¯ä»£ç 1006çš„å«ä¹‰

- **1006**: è¿æ¥å¼‚å¸¸å…³é—­ï¼Œæ²¡æœ‰æ”¶åˆ°å…³é—­å¸§
- **å¸¸è§åŸå› **: ç½‘ç»œä¸­æ–­ã€é˜²ç«å¢™é˜»æ­¢ã€CORSé™åˆ¶ã€ä»£ç†æœåŠ¡å™¨é—®é¢˜

### å¯èƒ½çš„åŸå› 

#### 1. **ç½‘ç»œç¯å¢ƒé™åˆ¶**

- ä¼ä¸šé˜²ç«å¢™é˜»æ­¢WebSocketè¿æ¥
- ç½‘ç»œä»£ç†æœåŠ¡å™¨ä¸æ”¯æŒWebSocket
- ISPé™åˆ¶WebSocketåè®®

#### 2. **æµè§ˆå™¨/CORSé—®é¢˜**

- è·¨åŸŸWebSocketè¿æ¥è¢«é˜»æ­¢
- æµè§ˆå™¨å®‰å…¨ç­–ç•¥é™åˆ¶
- è¯ä¹¦éªŒè¯é—®é¢˜

#### 3. **æœåŠ¡å™¨é…ç½®**

- Cloudflare Workers WebSocketé…ç½®é—®é¢˜
- æœåŠ¡å™¨è´Ÿè½½è¿‡é«˜
- ä¸´æ—¶ç½‘ç»œæ•…éšœ

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ç½‘ç»œç¯å¢ƒæ£€æŸ¥

#### æ­¥éª¤1: ä½¿ç”¨è¯Šæ–­å·¥å…·

1. è®¿é—® `/debug` é¡µé¢
2. ç‚¹å‡»"å¼€å§‹è¯Šæ–­"æŒ‰é’®
3. æŸ¥çœ‹è¯¦ç»†çš„è¯Šæ–­ç»“æœ

#### æ­¥éª¤2: ç½‘ç»œè¿æ¥æµ‹è¯•

```bash
# æµ‹è¯•åŸºæœ¬ç½‘ç»œè¿æ¥
ping getgoodtape-api-production.wangdonghuiibt-cloudflare.workers.dev

# æµ‹è¯•HTTPSè¿æ¥
curl -I https://getgoodtape-api-production.wangdonghuiibt-cloudflare.workers.dev/api/health
```

#### æ­¥éª¤3: é˜²ç«å¢™æ£€æŸ¥

- æ£€æŸ¥ä¼ä¸šé˜²ç«å¢™è®¾ç½®
- ç¡®ä¿å…è®¸WebSocketè¿æ¥ (ç«¯å£443)
- è”ç³»ç½‘ç»œç®¡ç†å‘˜å¼€æ”¾WebSocketåè®®

### æ–¹æ¡ˆ2: æµè§ˆå™¨ç¯å¢ƒä¼˜åŒ–

#### æ­¥éª¤1: æµè§ˆå™¨è®¾ç½®

- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒCookie
- ç¦ç”¨æµè§ˆå™¨æ‰©å±•ï¼ˆç‰¹åˆ«æ˜¯å¹¿å‘Šæ‹¦æˆªå™¨ï¼‰
- å°è¯•æ— ç—•/éšç§æ¨¡å¼

#### æ­¥éª¤2: è¯ä¹¦æ£€æŸ¥

- ç¡®ä¿ç³»ç»Ÿæ—¶é—´æ­£ç¡®
- æ£€æŸ¥SSLè¯ä¹¦æ˜¯å¦æœ‰æ•ˆ
- å°è¯•è®¿é—®: https://getgoodtape-api-production.wangdonghuiibt-cloudflare.workers.dev

#### æ­¥éª¤3: ä¸åŒæµè§ˆå™¨æµ‹è¯•

- Chrome/Edge
- Firefox
- Safari

### æ–¹æ¡ˆ3: ç½‘ç»œç¯å¢ƒåˆ‡æ¢

#### ç§»åŠ¨ç½‘ç»œæµ‹è¯•

- ä½¿ç”¨æ‰‹æœºçƒ­ç‚¹
- åˆ‡æ¢åˆ°ä¸åŒçš„ç½‘ç»œç¯å¢ƒ
- æµ‹è¯•æ˜¯å¦æ˜¯ç½‘ç»œé™åˆ¶é—®é¢˜

#### VPNæµ‹è¯•

- ä½¿ç”¨VPNè¿æ¥
- é€‰æ‹©ä¸åŒçš„æœåŠ¡å™¨ä½ç½®
- æµ‹è¯•WebSocketè¿æ¥

### æ–¹æ¡ˆ4: åº”ç”¨å±‚è§£å†³æ–¹æ¡ˆ

#### HTTPè½®è¯¢å¤‡é€‰æ–¹æ¡ˆ

åº”ç”¨å·²ç»å†…ç½®äº†HTTPè½®è¯¢ä½œä¸ºWebSocketçš„å¤‡é€‰æ–¹æ¡ˆï¼š

```typescript
// è‡ªåŠ¨é™çº§åˆ°HTTPè½®è¯¢
if (webSocketFailed) {
  // ä½¿ç”¨HTTPè½®è¯¢è·å–çŠ¶æ€æ›´æ–°
  setInterval(() => {
    fetch('/api/status/' + jobId)
      .then(response => response.json())
      .then(data => updateStatus(data));
  }, 1000);
}
```

## ğŸ”§ å¼€å‘è€…è§£å†³æ–¹æ¡ˆ

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

#### æ–¹æ¡ˆ1: ä½¿ç”¨æœ¬åœ°Workers

```bash
# å®‰è£…Wrangler
npm install -g wrangler

# å¯åŠ¨æœ¬åœ°Workers
wrangler dev

# æ›´æ–°WebSocket URLä¸ºæœ¬åœ°åœ°å€
const wsUrl = 'ws://localhost:8787/api/ws';
```

#### æ–¹æ¡ˆ2: WebSocketæ¨¡æ‹Ÿ

```typescript
// å¼€å‘ç¯å¢ƒWebSocketæ¨¡æ‹Ÿ
if (process.env.NODE_ENV === 'development') {
  // ä½¿ç”¨HTTPè½®è¯¢æ¨¡æ‹ŸWebSocket
  const simulateWebSocket = () => {
    setInterval(() => {
      // æ¨¡æ‹ŸWebSocketæ¶ˆæ¯
      onMessage({ type: 'progress', data: { progress: 50 } });
    }, 1000);
  };
}
```

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

#### Cloudflare Workersé…ç½®

```toml
# wrangler.toml
[env.production]
compatibility_flags = ["websocket"]

# ç¡®ä¿WebSocketæ”¯æŒ
[[env.production.services]]
binding = "WEBSOCKET"
service = "websocket-service"
```

#### é”™è¯¯å¤„ç†å¢å¼º

```typescript
// å¢å¼ºçš„WebSocketè¿æ¥
const connectWithRetry = (url, maxRetries = 3) => {
  let retries = 0;

  const connect = () => {
    const ws = new WebSocket(url);

    ws.onopen = () => {
      console.log('WebSocketè¿æ¥æˆåŠŸ');
      retries = 0;
    };

    ws.onclose = event => {
      if (event.code === 1006 && retries < maxRetries) {
        retries++;
        console.log(`WebSocketé‡è¿å°è¯• ${retries}/${maxRetries}`);
        setTimeout(connect, 1000 * retries);
      } else {
        console.log('WebSocketè¿æ¥å¤±è´¥ï¼Œåˆ‡æ¢åˆ°HTTPè½®è¯¢');
        fallbackToPolling();
      }
    };
  };

  connect();
};
```

## ğŸ“Š è¯Šæ–­å·¥å…·ä½¿ç”¨

### WebSocketçŠ¶æ€ç›‘æ§

- **ä½ç½®**: `/debug` é¡µé¢
- **åŠŸèƒ½**: å®æ—¶WebSocketè¿æ¥çŠ¶æ€
- **ä¿¡æ¯**: è¿æ¥å»¶è¿Ÿã€é”™è¯¯è¯¦æƒ…ã€ç¯å¢ƒä¿¡æ¯

### WebSocketè¿æ¥è¯Šæ–­

- **ä½ç½®**: `/debug` é¡µé¢ä¸‹æ–¹
- **åŠŸèƒ½**: å…¨é¢çš„è¿æ¥è¯Šæ–­
- **æµ‹è¯•é¡¹ç›®**:
  - ç½‘ç»œè¿æ¥æµ‹è¯•
  - Workers APIå¯ç”¨æ€§
  - WebSocketæ”¯æŒæ£€æŸ¥
  - å®é™…è¿æ¥æµ‹è¯•
  - ç¯å¢ƒä¿¡æ¯æ”¶é›†

### ä½¿ç”¨æ­¥éª¤

1. è®¿é—® `http://localhost:3000/debug`
2. æŸ¥çœ‹"WebSocketçŠ¶æ€"éƒ¨åˆ†
3. ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
4. æŸ¥çœ‹"WebSocketè¿æ¥è¯Šæ–­"éƒ¨åˆ†
5. ç‚¹å‡»"å¼€å§‹è¯Šæ–­"è¿›è¡Œå…¨é¢æ£€æŸ¥

## ğŸ¯ å¸¸è§è§£å†³æ–¹æ¡ˆ

### ä¼ä¸šç½‘ç»œç¯å¢ƒ

```
é—®é¢˜: ä¼ä¸šé˜²ç«å¢™é˜»æ­¢WebSocket
è§£å†³:
1. è”ç³»ITéƒ¨é—¨å¼€æ”¾WebSocketåè®®
2. ä½¿ç”¨HTTPè½®è¯¢å¤‡é€‰æ–¹æ¡ˆ
3. é€šè¿‡VPNè¿æ¥
```

### å®¶åº­ç½‘ç»œç¯å¢ƒ

```
é—®é¢˜: ISPé™åˆ¶æˆ–è·¯ç”±å™¨é…ç½®
è§£å†³:
1. é‡å¯è·¯ç”±å™¨
2. æ›´æ–°è·¯ç”±å™¨å›ºä»¶
3. è”ç³»ISPæŠ€æœ¯æ”¯æŒ
```

### ç§»åŠ¨ç½‘ç»œç¯å¢ƒ

```
é—®é¢˜: ç§»åŠ¨ç½‘ç»œé™åˆ¶
è§£å†³:
1. åˆ‡æ¢åˆ°WiFiç½‘ç»œ
2. ä½¿ç”¨ä¸åŒçš„ç§»åŠ¨ç½‘ç»œè¿è¥å•†
3. å¯ç”¨VPN
```

## ğŸ”® é¢„é˜²æªæ–½

### åº”ç”¨å±‚é¢

- âœ… è‡ªåŠ¨é™çº§åˆ°HTTPè½®è¯¢
- âœ… è¿æ¥é‡è¯•æœºåˆ¶
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### ç›‘æ§å±‚é¢

- âœ… å®æ—¶è¿æ¥çŠ¶æ€ç›‘æ§
- âœ… è¿æ¥æˆåŠŸç‡ç»Ÿè®¡
- âœ… é”™è¯¯ç±»å‹åˆ†æ
- âœ… ç½‘ç»œç¯å¢ƒæ£€æµ‹

## ğŸ“‹ æ€»ç»“

### å…³é”®ç‚¹

1. **1006é”™è¯¯é€šå¸¸æ˜¯ç½‘ç»œç¯å¢ƒé—®é¢˜**ï¼Œä¸æ˜¯åº”ç”¨ç¨‹åºé”™è¯¯
2. **HTTPè½®è¯¢æ˜¯å¯é çš„å¤‡é€‰æ–¹æ¡ˆ**ï¼ŒåŠŸèƒ½å®Œå…¨ä¸å—å½±å“
3. **è¯Šæ–­å·¥å…·å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜**åŸå› 
4. **å¤šç§è§£å†³æ–¹æ¡ˆ**é€‚åº”ä¸åŒçš„ç½‘ç»œç¯å¢ƒ

### ç”¨æˆ·å»ºè®®

- ğŸ” **é¦–å…ˆä½¿ç”¨è¯Šæ–­å·¥å…·**æ£€æŸ¥é—®é¢˜
- ğŸŒ **å°è¯•ä¸åŒç½‘ç»œç¯å¢ƒ**ï¼ˆWiFiã€ç§»åŠ¨ç½‘ç»œã€VPNï¼‰
- ğŸ”„ **åº”ç”¨åŠŸèƒ½ä¸å—å½±å“**ï¼ŒHTTPè½®è¯¢ä¼šè‡ªåŠ¨æ¥ç®¡
- ğŸ“ **å¦‚éœ€å¸®åŠ©**ï¼Œæä¾›è¯Šæ–­ç»“æœç»™æŠ€æœ¯æ”¯æŒ

### å¼€å‘è€…å»ºè®®

- ğŸ“Š **ç›‘æ§WebSocketè¿æ¥æˆåŠŸç‡**
- ğŸ”§ **ä¼˜åŒ–é‡è¿æœºåˆ¶**
- ğŸ“ **æ”¶é›†é”™è¯¯ç»Ÿè®¡**
- ğŸš€ **è€ƒè™‘Server-Sent Eventsä½œä¸ºå¤‡é€‰**

WebSocket 1006é”™è¯¯è™½ç„¶å¸¸è§ï¼Œä½†é€šè¿‡åˆé€‚çš„è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç¡®ä¿ç”¨æˆ·è·å¾—è‰¯å¥½çš„ä½“éªŒï¼ğŸ‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-08-07  
**é€‚ç”¨èŒƒå›´**: GetGoodTape WebSocketè¿æ¥é—®é¢˜
